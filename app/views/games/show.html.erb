<style type="text/css">
  h1 {
    text-align: center;
  }

  .home_team {
    text-align: right;
  }

  .away_team {
    text-align: left;
  }

  .vs {
    font-size: 35px;
  }

  .challenge-form {
    text-align: center;

  }

  .opponents {
    text-align: center;
    margin: 20px 0;
  }

  .opponents a {
    display: block;
  }

  .agree {
    color: green;
  }

  .disagree {
    color: red;
  }

  .comments {
    background-color: #DDE1E6;
    border-radius: 5px;
    padding: 10px;
  }

  .comment {
    margin-left: 10px;
    border-bottom: solid 1px gray;
  }

  .comment-material {
    color: black;
    margin-top: 5px;
  }

  .call .challenge {
    margin: 10px;
  }

</style>

<div class="container opponents">
  <div class="row">
    <div class="col-md-5 home_team">
  <%= image_tag(@game.home_team.img_url) %>
  <%= link_to @game.home_team.name, team_url(team_id: @game.home_team.id) %>
    </div>
    <div class="col-md-2 vs">
   vs.
    </div>
    <div class="col-md-5 away_team">
   <%= image_tag(@game.away_team.img_url) %>
   <%= link_to @game.away_team.name, team_url(team_id: @game.away_team.id) %>
    </div>
   </div>
</div>

<%= render 'challenges/form', game_id: @game.id %>

<%= notice %>

<% if current_user.username == 'JimmyMow' %>
  <%= link_to 'Add a call', new_call_url(game_id: @game.id), :class => 'btn btn-primary add_call' %>
<% end %>


<!-- CALLS -->
<div class='container'>
  <div class='col-lg-12 challenge-form'>
      <p><%= paginate @calls %></p>
        <% @game.calls.each do |call| %>
          <div class='call'>
            <%= call.description %>

            <% if current_user.calls.include?(call) %>
              <%= render 'downvote_call', call: call %>
            <% else %>
              <%= link_to "<i class=\"fa fa-thumbs-o-down fa-lg disagree\"></i>".html_safe, call_votes_url(user_id: current_user.id, call_id: call.id, vote: false, format: :js), remote: true, method: 'post', :id => "call-disagree-#{call.id}" %>
            <% end %>


            <%= render 'call_votes/vote_counter', call: call %>

            <%= link_to pluralize(call.comments.count, 'Comment'), "#", :class => 'show_comments' %>

            <div class='comments'>
              <%= render 'comments/form', call: call %>

              <% call.comments.reverse.each do |comment| %>
                  <%= render 'comments/comment', comment: comment %>
              <% end %><!-- COMMENTS END -->
            </div><!-- COMMENTS -->
          </div><!-- CALL -->
        <% end %><!-- CALLS END -->

      <% @game.challenges.reverse.each do |challenge| %>
          <div class='challenges'>
          <%= challenge.description %>

        <% challenge_ids = current_user.challenge_votes.collect { |c| c.challenge_id } %>
        <% if challenge_ids.include?(challenge.id) %>
          <%= render 'upvote_challenge', challenge: challenge %>
        <% else %>
          <%= link_to "<i class=\"fa fa-thumbs-o-up fa-lg agree\"></i>".html_safe, challenge_votes_url(user_id: current_user.id, challenge_id: challenge.id, game_id: challenge.game_id, vote: true), method: 'post', remote: true, :class => "like-challenge-#{challenge.id}" %>
        <% end %>

        <%= render 'challenge_votes/vote_counter', challenge: challenge %>

        <%= link_to pluralize(challenge.challenge_comments.count, 'Comment'), "#", :class => 'show_comments' %>

        <div class='comments'>
          <%= render 'challenge_comments/form', challenge: challenge %>

          <% challenge.challenge_comments.reverse.each do |comment| %>
            <%= render 'challenge_comments/comment', comment: comment %>
          <% end %>
        </div><!-- COMMENTS -->
      </div><!-- CHALLENGES -->
      <% end %>
  </div><!-- COL-LG-12 -->
</div><!-- CONTAINER -->



<script>
$(document).ready(function() {
  $(".comments").hide();
    $("a.show_comments").on("click", function() {
      console.log(this);
      var closestComment = $(this).siblings(".comments")
      closestComment.slideToggle();
      return false;
    });
  });
</script>



